"use strict";var d,muteBtn=$("#mute-btn"),groupIdInput=document.getElementById("group-id-entry");function checkGroupExists(e){if(e=e.trim(),isNaN(e))throw"Invalid";if(4!=e.length)throw"Group ID must be 4 characters";try{e=parseInt(e,10)}catch(e){throw"Invalid"}if(e<0)throw"Invalid";var t=null;return $.ajax({url:"api/checkGroupExists.php?access_token="+accessToken+"&group_id="+e,type:"get",dataType:"html",async:!1,success:function(e){t=e}}),"EXISTS"==t||"DOES NOT EXIST"!=d&&void 0}function setHoverPreviewListener(){for(var e=document.getElementsByClassName("preview-sound"),t=0;t<e.length;t++)e[t].volume=0;$(".song-cover").hover(function(){dashboardMuted||(document.getElementById(this.id+"-audio").play(),$("#"+this.id+"-audio").stop(!0,!1),$("#"+this.id+"-audio").animate({volume:.25},500))},function(){var e;dashboardMuted||(e=document.getElementById(this.id+"-audio"),$("#"+this.id+"-audio").stop(!0,!1),$("#"+this.id+"-audio").animate({volume:0},500,function(){e.pause()}))}),$(".song-cover").click(function(){createBtn($(this).attr("id"),$(this).data("context"))})}function joinBtn(){try{1==checkGroupExists(groupIdInput.value)?window.location.href="player.php?action=join&group_id="+groupIdInput.value:alert("Group does not exist.")}catch(e){"Invalid"==e?alert("Invalid Group ID entered."):"GET request error"==e?alert("An internal error occured. Error: GET_REQUEST_ERROR"):"Group ID must be 4 characters"==e?alert(e):alert("An unknown error occured. Error: "+e),groupIdInput.value=""}}function createBtn(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;$.ajax({url:"api/createGroupID.php?access_token="+accessToken,type:"get",dataType:"html",success:function(e){window.location.href=null==t?"player.php?action=create&group_id="+e:"player.php?action=create&group_id="+e+"&startSong=spotify:track:"+t+"&startContext="+n}})}$.ajaxSetup({cache:!1}),$(document).ready(function(){for(var e=document.getElementsByClassName("preview-sound"),t=0;t<e.length;t++)e[t].volume=0;dashboardMuted?muteBtn.css("background-image",'url("https://morahman.me/musictogether/img/muted.png'):muteBtn.css("background-image",'url("https://morahman.me/musictogether/img/unmuted.png')}),muteBtn.click(function(){dashboardMuted?muteBtn.css("background-image",'url("https://morahman.me/musictogether/img/unmuted.png'):muteBtn.css("background-image",'url("https://morahman.me/musictogether/img/muted.png'),dashboardMuted=!dashboardMuted,$.get("api/updateDashboardMuted.php",{access_token:accessToken,muted:dashboardMuted})}),setHoverPreviewListener(),"number"==typeof sess_val&&(groupIdInput.value=sess_val,joinBtn());var songsContainer=$(".songs-container"),scrollForward=$("#scroll-forward"),scrollBack=$("#scroll-back"),speed=.5;function getNextTracks(e){return new Promise(function(t,n){$.ajax({url:e,method:"GET",dataType:"json",headers:{Authorization:"Bearer "+accessToken},success:function(e){t(e)},error:function(e){n(e)}})})}function createRecentlyPlayedSong(e){var t="null";null!=e.context&&(t=e.context.uri),songsContainer.append('\n            <div style="opacity: 0" class="song-container '.concat(e.track.id,'-cont" id="').concat(e.track.id,'-cont">\n                    <audio class="preview-sound" id="').concat(e.track.id,'-audio" preload="auto" loop="" src="').concat(e.track.preview_url,'"></audio>\n                    <a class="song-cover" id="').concat(e.track.id,'" data-context="').concat(t,'">\n                        <img src="').concat(e.track.album.images[0].url,'" class="hvr-grow">\n                    </a>\n                    <div class="song-details-container">\n                        <div class="song-name">\n                            ').concat(e.track.name,'\n                        </div>\n                        <div class="song-artist">\n                            ').concat(e.track.artists[0].name,"\n                        </div>\n                    </div>\n                </div>\n        ")),$(".".concat(e.track.id,"-cont")).animate({opacity:1},250)}function addNewTracks(){return new Promise(function(t,n){getNextTracks(nextRecentlyPlayedHref).then(function(e){console.log(e),nextRecentlyPlayedHref=e.next,e.items.forEach(function(e){createRecentlyPlayedSong(e)}),scrollForward.fadeIn(250),$(".song-cover").unbind("mouseenter mouseleave"),setHoverPreviewListener(),t()},function(e){console.error(e),n(e)})})}scrollForward.hover(function(){scrollBack.fadeIn(250);var e=songsContainer.get(0).scrollWidth-songsContainer.outerWidth(),t=(e-songsContainer.scrollLeft())/speed;songsContainer.animate({scrollLeft:e},t,"linear",function(){scrollForward.fadeOut(250)})},function(){songsContainer.stop(!0,!1)}),scrollBack.hover(function(){scrollForward.fadeIn(250);var e=songsContainer.get(0).scrollWidth-songsContainer.outerWidth(),t=(e-(e-songsContainer.scrollLeft()))/speed;songsContainer.animate({scrollLeft:0},t,"linear",function(){scrollBack.fadeOut(250)})},function(){songsContainer.stop(!0,!1)}),songsContainer.scroll(function(){var e=songsContainer.get(0).scrollWidth-songsContainer.outerWidth();0==songsContainer.scrollLeft()?(scrollBack.fadeOut(250),scrollForward.fadeIn(250)):songsContainer.scrollLeft()==e?(scrollBack.fadeIn(250),scrollForward.fadeOut(250),addNewTracks()):(scrollBack.fadeIn(250),scrollForward.fadeIn(250))}),scrollBack.fadeOut(0);